# Latch Configuration - Azure Government DoD Cloud
# Copy to .env.local and fill in your values

# Azure AD Application (from Azure Government Portal → App Registrations)
# Portal: https://portal.azure.us
LATCH_CLIENT_ID=00000000-0000-0000-0000-000000000000
LATCH_TENANT_ID=11111111-1111-1111-1111-111111111111

# Cloud Environment (do not change for DoD)
LATCH_CLOUD=dod

# OAuth Scopes (space-separated)
# IMPORTANT: Do NOT use https://graph.microsoft.com URLs
# Use simple scope names - Latch will use correct DoD endpoints
#
# Common scopes:
#   openid profile        - Basic user info
#   User.Read             - Read user profile
#   Mail.Read             - Read user email
#   Calendars.Read        - Read user calendar
#   Files.Read            - Read user files
LATCH_SCOPES=openid profile User.Read

# OAuth Redirect URI (must match Azure AD app registration)
# Default: http://localhost:3000/api/latch/callback
# Production: https://yourapp.mil/api/latch/callback
LATCH_REDIRECT_URI=http://localhost:3000/api/latch/callback

# Cookie Encryption Secret (REQUIRED - generate with: openssl rand -base64 32)
# NEVER commit this to git!
# For DoD: MUST use FIPS-compliant generation
# Use Node.js with --force-fips flag if required
LATCH_COOKIE_SECRET=

# Debug Mode (optional, set to 'true' for verbose logging)
# Note: Tokens are NEVER logged, even in debug mode
LATCH_DEBUG=false

# Next.js URL (used if LATCH_REDIRECT_URI not set)
NEXTAUTH_URL=http://localhost:3000

# ============================================
# OPTIONAL: For Direct Token Mode (client-side)
# ============================================
# Only needed if using useAccessToken() hook
# WARNING: Review DoD compliance requirements before enabling
# NEXT_PUBLIC_LATCH_CLOUD=dod
# NEXT_PUBLIC_LATCH_TENANT_ID=11111111-1111-1111-1111-111111111111

# ============================================
# Quick Start Checklist (DoD)
# ============================================
# 1. Go to Azure Government Portal (https://portal.azure.us)
# 2. Navigate to: App Registrations → Your App (in DoD region)
# 3. Copy "Application (client) ID" → LATCH_CLIENT_ID
# 4. Copy "Directory (tenant) ID" → LATCH_TENANT_ID
# 5. Generate FIPS-compliant cookie secret
# 6. Add to Authentication → Redirect URIs:
#    - http://localhost:3000/api/latch/callback (dev only)
#    - https://yourapp.mil/api/latch/callback (prod)
# 7. Grant API permissions (Microsoft Graph):
#    - User.Read (delegated)
# 8. Restart Next.js dev server with --force-fips if required

# ============================================
# Azure Government DoD Endpoints (Automatic)
# ============================================
# Latch automatically uses these endpoints for DoD:
#   - Login: https://login.microsoftonline.us
#   - Graph: https://dod-graph.microsoft.us (DoD-specific!)
#
# You do NOT need to specify these manually!

# ============================================
# Azure AD App Registration Settings
# ============================================
# Portal: https://portal.azure.us
#
# Platform: Web
# Redirect URIs:
#   - http://localhost:3000/api/latch/callback (dev only)
#   - https://yourapp.mil/api/latch/callback (prod - HTTPS required)
#
# Supported account types:
#   - Single tenant (required for DoD)
#
# API permissions:
#   - Microsoft Graph → Delegated permissions
#   - User.Read (minimum)
#   - Review all permissions with security team
#
# Certificates & secrets:
#   - NOT NEEDED (using PKCE)

# ============================================
# Common Issues (DoD)
# ============================================
# Error: "Cloud/Scope Mismatch"
#   → Do NOT use https://graph.microsoft.com in scopes
#   → Do NOT use https://graph.microsoft.us (that's GCC-High!)
#   → Use simple names: User.Read
#   → Latch automatically uses dod-graph.microsoft.us
#
# Error: "Tenant not found"
#   → Ensure you're using the DoD tenant ID
#   → Verify tenant is in DoD region (not GCC-High or commercial)
#
# Error: "Graph API returns 401"
#   → Latch uses https://dod-graph.microsoft.us automatically
#   → Verify scopes don't have explicit .com or .us URLs
#
# Error: "Invalid redirect URI"
#   → Must be registered in Azure Government portal
#   → Production MUST use HTTPS (.mil domain)
#   → Localhost allowed for dev only

# ============================================
# Compliance Notes (DoD)
# ============================================
# Impact Level: IL5 (DoD)
# FedRAMP: High
# DISA: SRG Level 2
# ITAR: Yes (requires approval)
#
# MANDATORY Security Requirements:
#   - HTTPS in production (TLS 1.2+)
#   - FIPS 140-2 compliant crypto (use --force-fips)
#   - Use Secure Proxy mode ONLY (no Direct Token mode)
#   - Rotate LATCH_COOKIE_SECRET every 60 days
#   - Enable Azure AD Conditional Access
#   - Implement MFA (required for DoD)
#   - Log all authentication events
#   - Review logs daily (Azure AD Sign-ins)
#   - Audit permissions quarterly
#
# Network Requirements:
#   - Must access from DoD network or approved VPN
#   - Client devices must be DoD-approved
#   - Consider using Azure Private Link
#
# Direct Token Mode:
#   - Generally NOT permitted for DoD IL5
#   - Requires security review and approval
#   - Use Secure Proxy mode instead

# ============================================
# FIPS Mode (DoD IL5 Requirement)
# ============================================
# Start Node.js with FIPS mode:
#   node --force-fips server.js
#
# Or add to package.json:
#   "start": "node --force-fips .next/standalone/server.js"
#
# Verify FIPS mode:
#   process.stdout.write(crypto.getFips() ? 'FIPS enabled' : 'FIPS disabled');

# ============================================
# Deployment Checklist (DoD)
# ============================================
# [ ] HTTPS enabled (TLS 1.2+)
# [ ] FIPS mode enabled (--force-fips)
# [ ] Cookie secret rotated (60 days)
# [ ] MFA enforced in Azure AD
# [ ] Conditional Access policies configured
# [ ] Secure Proxy mode only (no Direct Token)
# [ ] Azure AD logs enabled and monitored
# [ ] Application hosted in DoD region
# [ ] Network access restricted (DoD only)
# [ ] Security scanning completed (CodeQL)
# [ ] Penetration testing completed
# [ ] ATO (Authority to Operate) obtained
